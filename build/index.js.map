{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Catchment from 'catchment'\nimport {\n  createWriteStream,\n  createReadStream,\n} from 'fs'\nimport { Writable } from 'stream'\n\n/**\n * Handles the flow of streams, and awaits for them to complete. The input can be specified either as a string with the `source` property, or as as stream with the `readable`. The output can also be given either as a string with the `destination`, or as a stream with the `writable`. If destination is passed as the `-`, the output becomes `process.stdout`.\n * @param {Config} config Configuration object. Includes `source`, `readable`, `destination` and `writable` properties.\n * @param {string} [config.source] The path to a source file from which to read data.\n * @param {Readable} [config.readable] An optional input stream, if the `source` is not given.\n * @param {string} [config.destination] The path to an output file. If `-` is given, `process.stdout` will be used. If the path of the input stream is the same as of the output one, the result will be first written to the memory, and only then to the destination file. Moreover, when used with the `readable` specified to overwrite the file from which data is originally read from, the `source` should also be passed.\n * @param {Writable} [config.writable] A stream into which to pipe the input stream, if `destination` is not given.\n */\nasync function whichStream(config) {\n  const {\n    source,\n    destination,\n  } = config\n  let { readable, writable } = config\n\n  if (!(source || readable))\n    throw new Error('Please give either a source or readable.')\n  if (!(destination || writable))\n    throw new Error('Please give either a destination or writable.')\n\n  if (source && !readable) readable = createReadStream(source)\n\n  if (destination == '-') {\n    readable.pipe(process.stdout)\n  } else if (destination) {\n    await handleWriteStream(destination, readable, source)\n  } else if (writable instanceof Writable) {\n    readable.pipe(writable)\n    await new Promise((r, j) => {\n      writable.on('error', j)\n      writable.on('finish', r)\n    })\n  }\n}\n\nconst handleWriteStream = async (destination, readable, source) => {\n  if (readable.path == destination || source == destination) {\n    const { promise } = new Catchment({ rs: readable })\n    const res = await promise\n    await new Promise((r, j) => {\n      // must create writable after reading\n      const writable = createWriteStream(destination)\n      writable\n        .once('error', j)\n        .end(res, r)\n    })\n  } else {\n    await new Promise((r, j) => {\n      const writable = createWriteStream(destination)\n      readable.pipe(writable)\n      writable\n        .once('error', j)\n        .on('close', r)\n    })\n  }\n}\n\n/* documentary types/index.xml */\n/**\n * @typedef {import('stream').Readable} Readable\n * @typedef {import('stream').Writable} Writable\n *\n * @typedef {Object} Config Configuration object. Includes `source`, `readable`, `destination` and `writable` properties.\n * @prop {string} [source] The path to a source file from which to read data.\n * @prop {Readable} [readable] An optional input stream, if the `source` is not given.\n * @prop {string} [destination] The path to an output file. If `-` is given, `process.stdout` will be used. If the path of the input stream is the same as of the output one, the result will be first written to the memory, and only then to the destination file. Moreover, when used with the `readable` specified to overwrite the file from which data is originally read from, the `source` should also be passed.\n * @prop {Writable} [writable] A stream into which to pipe the input stream, if `destination` is not given.\n */\n\nexport default whichStream"]}